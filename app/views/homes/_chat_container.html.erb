<div id = "chat-content" data-page_count = "<%= @page_count %>">
    <% message_date = "foo" %>
    <% @messages.each do |message| %>
        <% if message_date != message.created_at.strftime("%m月%d日") %>
            <% message_date = message.created_at.strftime("%m月%d日") %>
            <span class = "message-date"><%= message_date %></span>
        <% end %>
        <% message_user = message.user %>
        <% message_relations = message.general_message_relations %>
        <% first_user = message_relations.first.receive_user %>
        <% if message_user == current_user %>
            <div class = "message-content current-user">
                <span class = "message-user-name">
                    送信先 :
                    <%= link_to first_user.name, user_path(first_user.public_uid), remote: true %>
                    <% if message_relations.length >= 2 %>
                        <span>、他<%= message_relations.length - 1 %>人</span>
                    <% end %>
                    <%= link_to "送信先一覧", general_message_path(message.id), class: "send-users-display-btn", remote: true %>
                </span>
                <p class = "message">
                    <%= safe_join(message.content.split("\n"), tag(:br)) %>
                    <% if message.room_id.present? %>
                        <br><%= link_to "スケジュール追加", schedules_meeting_new_path(meeting_room_id: message.room_id), remote: true, class: "schedule-add-meeting" %>
                        <br><%= link_to "ミーティングへ", meeting_room_path(message.room_id), data: {"turbolinks"=>false} %>
                    <% end %>
                </p>
                <span class = "message-time"><%= l message.created_at %></span>
            </div>
        <% else %>
            <div class = "message-content other-user">
                <span class = "message-user-name">
                    <span class = "return-message-btn" data-message_user = "<%= message_user.public_uid %>"><i class="fas fa-share"></i> 返信 </span>
                    <%= link_to message_user.name, user_path(message_user.public_uid), remote: true %>
                </span>
                <p class = "message">
                    <%= safe_join(message.content.split("\n"), tag(:br)) %>
                    <% if message.room_id.present? %>
                        <br><%= link_to "スケジュール追加", schedules_meeting_new_path(meeting_room_id: message.room_id), remote: true, class: "schedule-add-meeting" %>
                        <br><%= link_to "ミーティングへ", meeting_room_path(message.room_id), data: {"turbolinks"=>false} %>
                    <% end %>
                </p>
                <span class = "message-time"><%= l message.created_at %></span>
            </div>
        <% end %>
    <% end %>
</div>
